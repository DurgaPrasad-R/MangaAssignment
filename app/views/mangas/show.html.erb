<div class="container">
<div class="d-flex justify-content-end mt-3">
<%= link_to 'Back', mangas_path, class: 'btn btn-secondary' %>
</div>
<div class="container">
<div class="d-flex gap-5">
  <% if @manga.cover_image.present? %>
    <%= image_tag Cloudinary::Utils.cloudinary_url(@manga.cover_image) %>
  <% else %>
    <p>No cover image available.</p>
  <% end %>
<div class="bg-body-tertiary w-75 p-5">
  <div class="d-flex fw-bold w-50 justify-content-between">
    <p class="m-0 p-0">Title:</p>
    <p class="m-0 p-0"><%= @manga.title %></p>
  </div>
  <div class="d-flex fw-bold w-50 justify-content-between">
    <p class="m-0 p-0">Author:</p>
    <p class="m-0 p-0"><%= @manga.author %></p>
  </div>
  <div class= "d-flex fw-bold w-50 justify-content-between">
    <p class="m-0 p-0">Categories:
    <p class="m-0 p-0"><%= @manga.categories.map(&:name).join(", ") %></p>
  </div>
  <div class="d-flex fw-bold w-50 justify-content-between">
    <p class="m-0 p-0"><small>Published Date:</small></p>
    <p class="m-0 p-0"><small><%= @manga.published_date %></small></p>
  </div>
  <%= link_to 'Add New Chapter', new_manga_chapter_path(@manga), class: 'btn btn-primary mt-3' %>
  </div>
</div>
  <p class="fw-bold m-0 p-0">Brief Description:</p>
  <p><%= @manga.description %></p>
</p>

  
  <h2>Chapters</h2>
  <% if @manga.chapters.any? %>
    <ul>
      <% @manga.chapters.each do |chapter| %>
        <li>
          <%= link_to "#{chapter.title}", manga_chapter_path(@manga, chapter), class: 'chapter-link' %>
        </li>
      <% end %>
    </ul>
  <% else %>
    <p>No chapters available.</p>
  <% end %>


<% @manga.ratings.each do |rating| %>
  <p><strong>Unknown:</strong> <%= rating.rating %> stars</p>
<% end %>

<% unless @manga.ratings.exists?(user: current_user) %>
  <h3>Submit Your Rating</h3>
  <%= form_with model: [@manga, Rating.new], url: manga_ratings_path(@manga), method: :post, local: true, html: { class: "needs-validation", novalidate: true } do |f| %>
    <div class="form-group">
      <%= f.number_field :rating, in: 1..5, class: "form-control", required: true, placeholder: "Enter a rating between 1 and 5" %>
    </div>
    <%= f.submit "Submit Rating", class: "btn btn-primary mb-3 mt-1" %>
  <% end %>
<% else %>
  <p>You have already rated this manga.</p>
<% end %>



<% @manga.comments.each do |comment| %>
  <p><strong>Unknown:</strong> <%= comment.content %></p>
<% end %>

<% unless @manga.comments.exists?(user: current_user) %>
  <h3>Leave a Comment</h3>
  <%= form_with model: [@manga, Comment.new], url: manga_comments_path(@manga), method: :post, local: true, html: { class: "needs-validation", novalidate: true } do |f| %>
    <div class="form-group">
      <%= f.text_area :content, class: "form-control", rows: 5, placeholder: "Write your comment here...", required: true %>
    </div>
    <%= f.submit "Submit Comment", class: "btn btn-primary mt-1 mb-3" %>
  <% end %>
<% else %>
  <p>You have already commented on this manga.</p>
<% end %>

</div>
</div>